{% extends "base.html.j2" %}

{% block title %}Index{% endblock %}

{% block head %}
    {{ super() }}
    <script type="text/javascript">
        $(document).ready(function() {
            var tiny_ifr = $('#myta_ifr');

            tiny_ifr.contents().find("[id^=warning-]").mouseenter(function(){
                var index = parseInt($(this).attr("id").replace('warning-',''), 10);
                highlight(index, true);
            });

            tiny_ifr.contents().find("[id^=warning-]").mouseleave(function(){
                var index = parseInt($(this).attr("id").replace('warning-',''), 10);
                highlight(index, false);
            });

            $("[id^=warning-]").mouseenter(function(){
                var index = parseInt($(this).attr("id").replace('warning-',''), 10);
                console.log("enters");
                highlight(index, true);
            });

            $("[id^=warning-]").mouseleave(function(){
                var index = parseInt($(this).attr("id").replace('warning-',''), 10);
                console.log("leaves");
                highlight(index, false);
            });

            function highlight(index, enters){
                var tiny_ifr = $('#myta_ifr');
                var a = tiny_ifr.contents().find("[id=warning-" + index + "]");
                var b = $("[id=warning-" + index + "]");
                if(enters){
                    a.css("background-color", "#fdca40");
                    b.removeClass("hide");
                }else{
                    a.css("background-color", "#ffe18f");
                    b.addClass("hide");
                }
            }
        });
    </script>
{% endblock %}

{% block content %}
    <div class="row">
        <div class="medium-7 large-6 columns">
            <h1>Rédigez facilement</h1>
            <p class="subheader">Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p>
            <button class="button">Take a Tour</button>
            <button class="button highlight">Start a free trial</button>
        </div>
        <div class="show-for-large large-3 columns">
            <img src="/static/logo.png" alt="picture of space">
        </div>
    </div>


    <form action="/" id="myform" method="post">
        <div class="row">
            <h1> </h1>
        </div>

        <div class="row">
            <div class="medium-8 columns">
                <div class="row">
                    <textarea id="myta" class="main-text" name="text" form="myform">
                        {% for t in text -%}
                        {% set outer_loop = loop -%}
                            {% for warning in warnings -%}
                                {% if outer_loop.index0 == warning.start %}
                                    <span id="warning-{{ warning.index }}" style="background-color: #ffe18f;">
                                {% endif %}
                            {%- endfor -%}
                            {{ t }}
                            {%- for warning in warnings -%}
                                {% if outer_loop.index0 == warning.end -%}
                                    </span>
                                {%- endif %}
                            {%- endfor %}
                        {%- endfor %}
                    </textarea>
                </div>
                <br>
                <div class="row">
                    <input type="submit" class="button">
                </div>
            </div>
            <div class="medium-4 columns">
                {% if warnings %}
                    <div class="callout">
                        <h5>Errors summary</h5>
                        <span class="badge alert">{{ warnings|length }}</span> errors.
                    </div>
                    {% for warning in warnings %}
                        <div class="callout alert hide" id="warning-{{ warning.index }}">
                            <p>{{ warning.comment }}</p>
                            <p class="warning-snippet"><i>{{ warning.snippet }}</i></p>
                        </div>
                    {% endfor %}
                {% else %}
                    <div class="callout success">
                        <p>Aucun problème rencontré</p>
                    </div>
                {% endif %}
            </div>
        </div>
    </form>
{% endblock %}
